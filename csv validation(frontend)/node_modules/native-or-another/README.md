# native-or-another [![NPM version](https://img.shields.io/npm/v/native-or-another.svg?style=flat)](https://www.npmjs.com/package/native-or-another) [![mit license][license-img]][license-url] [![NPM monthly downloads](https://img.shields.io/npm/dm/native-or-another.svg?style=flat)](https://npmjs.org/package/native-or-another) [![npm total downloads][downloads-img]][downloads-url]

> Guaranteed way for getting a Promise. Always native Promise if available, otherwise looks for common promise libraries and loads which is installed. Allows registering custom Promise implementation in node < 0.12 versions

[![code climate][codeclimate-img]][codeclimate-url] 
[![code style][standard-img]][standard-url] 
[![linux build][travis-img]][travis-url] 
[![windows build][appveyor-img]][appveyor-url] 
[![code coverage][coverage-img]][coverage-url] 
[![dependency status][david-img]][david-url]
[![paypal donate][paypalme-img]][paypalme-url] 

_Pretty much like [any-promise][], but works a bit different & better._

> Let your library support any ES 2015 (ES6) compatible Promise and leave the 
choice to application authors. The application can optionally register its preferred 
Promise implementation and it will be exported when requiring any-promise from library code.
–– [any-promise][]

If no preference is registered, always defaults to native Promise,
using [native-promise][] detection. It defaults to global Promise for 
newer Node.js `>= 0.12` versions. The browser version defaults 
to the window Promise, so polyfill or register as necessary.

## Table of Contents
- [Install](#install)
- [Usage](#usage)
  * [Get a Promise, always](#get-a-promise-always)
  * [Custom Promise registration](#custom-promise-registration)
  * [Support for old Node.js versions](#support-for-old-nodejs-versions)
- [Related](#related)
- [Contributing](#contributing)
- [Building docs](#building-docs)
- [Running tests](#running-tests)
- [Author](#author)
- [License](#license)

_(TOC generated by [verb](https://github.com/verbose/verb) using [markdown-toc](https://github.com/jonschlinkert/markdown-toc))_

## Install
Install with [npm](https://www.npmjs.com/)

```
$ npm install native-or-another --save
```

or install using [yarn](https://yarnpkg.com)

```
$ yarn add native-or-another
```

## Usage
> For more use-cases see the [tests](test.js). 

Examples assumes that they are ran in older node versions, meaning `< 0.12`, be aware of that!

### Get a Promise, always

Use it as any other Promise. It will give you native Promise always, 
until node < 0.12 - in that case it will try to load one of the [common promise libraries](./register.js#L15-L26), 
otherwise it will throw with a useful message to signal your users to install 
some of these promise implementations or `register` other one. 

```js
const Promise = require('native-or-another')

const promise = new Promise((resolve, reject) => {
  resolve(123)
})

promise.then((res) => console.log('foo:', res))
```

### Custom Promise registration

You can `.register()` a custom Promise which will be used by the main export.
That function also returns that Promise. If no arguments are passed, it will try to load some
of the common promise libraries, again.

```js
const register = require('native-or-another/register')

const MyCustomPromise = () => 444
register({ Promise: MyCustomPromise })

const Promize = require('native-or-another')

// loads `MyCustomPromise`
const res = Promize()
console.log(res) // => 444

// but also adds it to global scope
const res = Promise()
console.log(res) // => 444

// but also adds it to global.Promise
const res = global.Promise()
console.log(res) // => 444
```

Notice that it adds the promise to global scope and `global`, if you don't want that behaviour
you should disable it through passing an option to `.register` function, like `{ global: false }`.

```js
const register = require('native-or-another/register')
const Promize = register({ global: false })

console.log(Promize) // => function
console.log(Promise) // => undefined
console.log(global.Promise) // => undefined
```

This is exactly how `require('native-or-another')` works!

### Support for old Node.js versions

Node.js versions prior to `v0.12` may have contained buggy versions of the global `Promise`. 
For this reason, the global `Promise` is not loaded automatically for these old versions.  
If using `native-or-another` in Node.js versions `< v0.12`, the user should register a 
desired implementation.

If an implementation is not registered, `native-or-another` will attempt to discover 
an installed `Promise` implementation.  If no implementation can be found, an error 
will be thrown on `require('native-or-another')`.  While the auto-discovery usually avoids errors, 
it is non-deterministic. It is recommended that the user always register a preferred 
implementation for older Node.js versions.

This auto-discovery is only available for Node.js versions before `v0.12`. 
Any newer versions (includeing `v0.12`) will always default to the global `Promise` implementation.

> Adapted from the [any-promise][] readme.

## Related
- [clean-stacktrace](https://www.npmjs.com/package/clean-stacktrace): Clean up error stack traces from node internals | [homepage](https://github.com/tunnckocore/clean-stacktrace#readme "Clean up error stack traces from node internals")
- [find-callsite](https://www.npmjs.com/package/find-callsite): Finds the correct place where the stack trace was started, not the place where error was thrown | [homepage](https://github.com/tunnckocore/find-callsite#readme "Finds the correct place where the stack trace was started, not the place where error was thrown")
- [native-promise](https://www.npmjs.com/package/native-promise): Get native `Promise` or falsey value if not available. | [homepage](https://github.com/tunnckocore/native-promise#readme "Get native `Promise` or falsey value if not available.")
- [redolent](https://www.npmjs.com/package/redolent): Simple promisify with sane defaults, works on node 0.10 if you provide custom Promise through options | [homepage](https://github.com/hybridables/redolent#readme "Simple promisify with sane defaults, works on node 0.10 if you provide custom Promise through options")
- [stacktrace-metadata](https://www.npmjs.com/package/stacktrace-metadata): Modify given `err` object to be more useful - adds `at`, `line`, `column`, `place` and `filename` properties… [more](https://github.com/tunnckocore/stacktrace-metadata#readme) | [homepage](https://github.com/tunnckocore/stacktrace-metadata#readme "Modify given `err` object to be more useful - adds `at`, `line`, `column`, `place` and `filename` properties and also cleans stack traces.")
- [try-catch-callback](https://www.npmjs.com/package/try-catch-callback): try/catch block with a callback, used in [try-catch-core][]. Use it when you don't care about asyncness so… [more](https://github.com/hybridables/try-catch-callback#readme) | [homepage](https://github.com/hybridables/try-catch-callback#readme "try/catch block with a callback, used in [try-catch-core][]. Use it when you don't care about asyncness so much and don't want guarantees. If you care use [try-catch-core][].")

## Contributing
Pull requests and stars are always welcome. For bugs and feature requests, [please create an issue](https://github.com/tunnckoCore/native-or-another/issues/new).  
Please read the [contributing guidelines](CONTRIBUTING.md) for advice on opening issues, pull requests, and coding standards.  
If you need some help and can spent some cash, feel free to [contact me at CodeMentor.io](https://www.codementor.io/tunnckocore?utm_source=github&utm_medium=button&utm_term=tunnckocore&utm_campaign=github) too.

**In short:** If you want to contribute to that project, please follow these things

1. Please DO NOT edit [README.md](README.md), [CHANGELOG.md](CHANGELOG.md) and [.verb.md](.verb.md) files. See ["Building docs"](#building-docs) section.
2. Ensure anything is okey by installing the dependencies and run the tests. See ["Running tests"](#running-tests) section.
3. Always use `npm run commit` to commit changes instead of `git commit`, because it is interactive and user-friendly. It uses [commitizen][] behind the scenes, which follows Conventional Changelog idealogy.
4. Do NOT bump the version in package.json. For that we use `npm run release`, which is [standard-version][] and follows Conventional Changelog idealogy.

Thanks a lot! :)

## Building docs
Documentation and that readme is generated using [verb-generate-readme][], which is a [verb][] generator, so you need to install both of them and then run `verb` command like that

```
$ npm install verbose/verb#dev verb-generate-readme --global && verb
```

_Please don't edit the README directly. Any changes to the readme must be made in [.verb.md](.verb.md)._

## Running tests
Clone repository and run the following in that cloned directory

```
$ npm install && npm test
```

## Author
**Charlike Mike Reagent**

+ [github/tunnckoCore](https://github.com/tunnckoCore)
+ [twitter/tunnckoCore](https://twitter.com/tunnckoCore)
+ [codementor/tunnckoCore](https://codementor.io/tunnckoCore)

## License
Copyright © 2014, 2017, [Charlike Mike Reagent](https://i.am.charlike.online). Released under the [MIT License](LICENSE).

***

_This file was generated by [verb-generate-readme](https://github.com/verbose/verb-generate-readme), v0.4.3, on March 17, 2017._  
_Project scaffolded using [charlike][] cli._

[always-done]: https://github.com/hybridables/always-done
[any-promise]: http://github.com/kevinbeaty/any-promise
[async-done]: https://github.com/gulpjs/async-done
[base]: https://github.com/node-base/base
[charlike]: https://github.com/tunnckocore/charlike
[commitizen]: https://github.com/commitizen/cz-cli
[dezalgo]: https://github.com/npm/dezalgo
[native-promise]: https://github.com/tunnckocore/native-promise
[once]: https://github.com/isaacs/once
[standard-version]: https://github.com/conventional-changelog/standard-version
[try-catch-core]: https://github.com/hybridables/try-catch-core
[verb-generate-readme]: https://github.com/verbose/verb-generate-readme
[verb]: https://github.com/verbose/verb

[license-url]: https://www.npmjs.com/package/native-or-another
[license-img]: https://img.shields.io/npm/l/native-or-another.svg

[downloads-url]: https://www.npmjs.com/package/native-or-another
[downloads-img]: https://img.shields.io/npm/dt/native-or-another.svg

[codeclimate-url]: https://codeclimate.com/github/tunnckoCore/native-or-another
[codeclimate-img]: https://img.shields.io/codeclimate/github/tunnckoCore/native-or-another.svg

[travis-url]: https://travis-ci.org/tunnckoCore/native-or-another
[travis-img]: https://img.shields.io/travis/tunnckoCore/native-or-another/master.svg?label=linux

[appveyor-url]: https://ci.appveyor.com/project/tunnckoCore/native-or-another
[appveyor-img]: https://img.shields.io/appveyor/ci/tunnckoCore/native-or-another/master.svg?label=windows

[coverage-url]: https://codecov.io/gh/tunnckoCore/native-or-another
[coverage-img]: https://img.shields.io/codecov/c/github/tunnckoCore/native-or-another/master.svg

[david-url]: https://david-dm.org/tunnckoCore/native-or-another
[david-img]: https://img.shields.io/david/tunnckoCore/native-or-another.svg

[standard-url]: https://github.com/feross/standard
[standard-img]: https://img.shields.io/badge/code%20style-standard-brightgreen.svg

[paypalme-url]: https://www.paypal.me/tunnckoCore
[paypalme-img]: https://img.shields.io/badge/paypal-donate-brightgreen.svg

