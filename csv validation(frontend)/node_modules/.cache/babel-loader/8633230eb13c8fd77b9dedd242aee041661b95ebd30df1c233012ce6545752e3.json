{"ast":null,"code":"(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('papaparse'), require('lodash/uniqBy'), require('lodash/isFunction'), require('famulus/isValuesUnique')) : typeof define === 'function' && define.amd ? define(['papaparse', 'lodash/uniqBy', 'lodash/isFunction', 'famulus/isValuesUnique'], factory) : global.myBundle = factory(global.Papa, global._uniqBy, global._isFunction, global.isValuesUnique);\n})(this, function (Papa, _uniqBy, _isFunction, isValuesUnique) {\n  'use strict';\n\n  Papa = Papa && Papa.hasOwnProperty('default') ? Papa['default'] : Papa;\n  isValuesUnique = isValuesUnique && isValuesUnique.hasOwnProperty('default') ? isValuesUnique['default'] : isValuesUnique;\n  _uniqBy = _uniqBy && _uniqBy.hasOwnProperty('default') ? _uniqBy['default'] : _uniqBy;\n  _isFunction = _isFunction && _isFunction.hasOwnProperty('default') ? _isFunction['default'] : _isFunction;\n\n  /**\n   * @param {File} csvFile\n   * @param {Object} config\n   */\n  function CSVFileValidator(csvFile, config) {\n    return new Promise(function (resolve, reject) {\n      Papa.parse(csvFile, {\n        skipEmptyLines: true,\n        complete: function complete(results) {\n          resolve(_prepareDataAndValidateFile(results.data, config));\n        },\n        error: function error(_error, file) {\n          reject({\n            error: _error,\n            file: file\n          });\n        }\n      });\n    });\n  }\n\n  /**\n   * @param {Array} csvData\n   * @param {Object} config\n   * @private\n   */\n  function _prepareDataAndValidateFile(csvData, config) {\n    var file = {\n      inValidMessages: [],\n      data: []\n    };\n    csvData.forEach(function (row, rowIndex) {\n      var columnData = {};\n      var headers = [];\n      for (var i = 0; i < config.headers.length; i++) {\n        var data = config.headers[i];\n        if (!data.optional) {\n          headers.push(data);\n        }\n      }\n      if (row.length < headers.length) {\n        return;\n      }\n      row.forEach(function (columnValue, columnIndex) {\n        var valueConfig = config.headers[columnIndex];\n        if (!valueConfig) {\n          return;\n        }\n\n        // header validation, skip if isHeaderNameOptional\n        if (rowIndex === 0) {\n          if (config.isHeaderNameOptional && valueConfig.name === columnValue) {\n            return;\n          }\n          if (!config.isHeaderNameOptional) {\n            if (valueConfig.name !== columnValue) {\n              file.inValidMessages.push(_isFunction(valueConfig.headerError) ? valueConfig.headerError(columnValue) : 'Header name ' + columnValue + ' is not correct or missing');\n            }\n            return;\n          }\n        }\n        if (valueConfig.required && !columnValue.length) {\n          file.inValidMessages.push(_isFunction(valueConfig.requiredError) ? valueConfig.requiredError(valueConfig.name, rowIndex + 1, columnIndex + 1) : String(valueConfig.name + ' is required in the ' + (rowIndex + 1) + ' row / ' + (columnIndex + 1) + ' column'));\n        } else if (valueConfig.validate && !valueConfig.validate(columnValue)) {\n          file.inValidMessages.push(_isFunction(valueConfig.validateError) ? valueConfig.validateError(valueConfig.name, rowIndex + 1, columnIndex + 1) : String(valueConfig.name + ' is not valid in the ' + (rowIndex + 1) + ' row / ' + (columnIndex + 1) + ' column'));\n        }\n        if (valueConfig.optional) {\n          columnData[valueConfig.inputName] = columnValue;\n        }\n        if (valueConfig.isArray) {\n          columnData[valueConfig.inputName] = columnValue.split(',').map(function (value) {\n            return value.trim();\n          });\n        } else {\n          columnData[valueConfig.inputName] = columnValue;\n        }\n      });\n      if (Object.keys(columnData).length) {\n        file.data.push(columnData);\n      }\n    });\n    _checkUniqueFields(file, config);\n    return file;\n  }\n\n  /**\n   * @param {Object} file\n   * @param {Object} config\n   * @private\n   */\n  function _checkUniqueFields(file, config) {\n    if (!file.data.length) {\n      return;\n    }\n    config.headers.filter(function (header) {\n      return header.unique;\n    }).forEach(function (header) {\n      if (!isValuesUnique(file.data, header.inputName)) {\n        file.inValidMessages.push(_isFunction(header.uniqueError) ? header.uniqueError(header.name) : String(header.name + ' is not unique'));\n      }\n    });\n  }\n  ;\n  return CSVFileValidator;\n});","map":{"version":3,"names":["global","factory","exports","module","require","define","amd","myBundle","Papa","_uniqBy","_isFunction","isValuesUnique","hasOwnProperty","CSVFileValidator","csvFile","config","Promise","resolve","reject","parse","skipEmptyLines","complete","results","_prepareDataAndValidateFile","data","error","file","csvData","inValidMessages","forEach","row","rowIndex","columnData","headers","i","length","optional","push","columnValue","columnIndex","valueConfig","isHeaderNameOptional","name","headerError","required","requiredError","String","validate","validateError","inputName","isArray","split","map","value","trim","Object","keys","_checkUniqueFields","filter","header","unique","uniqueError"],"sources":["C:/Users/rajen/OneDrive/Documents/csv validation/node_modules/csv-file-validator/src/csv-file-validator.js"],"sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined'\n\t\t? module.exports = factory(require('papaparse'), require('lodash/uniqBy'), require('lodash/isFunction'), require('famulus/isValuesUnique'))\n\t\t: typeof define === 'function' && define.amd\n\t\t\t? define(['papaparse', 'lodash/uniqBy', 'lodash/isFunction', 'famulus/isValuesUnique'], factory)\n\t\t\t: (global.myBundle = factory(global.Papa, global._uniqBy, global._isFunction, global.isValuesUnique));\n}(this, (function (Papa, _uniqBy, _isFunction, isValuesUnique) {\n\t'use strict';\n\n\tPapa = Papa && Papa.hasOwnProperty('default') ? Papa['default'] : Papa;\n\tisValuesUnique = isValuesUnique && isValuesUnique.hasOwnProperty('default') ? isValuesUnique['default'] : isValuesUnique;\n\t_uniqBy = _uniqBy && _uniqBy.hasOwnProperty('default') ? _uniqBy['default'] : _uniqBy;\n\t_isFunction = _isFunction && _isFunction.hasOwnProperty('default') ? _isFunction['default'] : _isFunction;\n\n\t/**\n\t * @param {File} csvFile\n\t * @param {Object} config\n\t */\n\tfunction CSVFileValidator(csvFile, config) {\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tPapa.parse(csvFile, {\n\t\t\t\tskipEmptyLines: true,\n\t\t\t\tcomplete: function (results) {\n\t\t\t\t\tresolve(_prepareDataAndValidateFile(results.data, config));\n\t\t\t\t},\n\t\t\t\terror: function (error, file) {\n\t\t\t\t\treject({ error: error, file: file });\n\t\t\t\t}\n\t\t\t});\n\t\t})\n\t}\n\n\t/**\n\t * @param {Array} csvData\n\t * @param {Object} config\n\t * @private\n\t */\n\tfunction _prepareDataAndValidateFile(csvData, config) {\n\t\tconst file = {\n\t\t\tinValidMessages: [],\n\t\t\tdata: []\n\t\t};\n\n\t\tcsvData.forEach(function (row, rowIndex) {\n\t\t\tconst columnData = {};\n\t\t\tconst headers = [];\n\n\t\t\tfor (let i = 0; i < config.headers.length; i++) {\n\t\t\t\tconst data = config.headers[i];\n\n\t\t\t\tif (!data.optional) {\n\t\t\t\t\theaders.push(data);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (row.length < headers.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trow.forEach(function (columnValue, columnIndex) {\n\t\t\t\tconst valueConfig = config.headers[columnIndex];\n\n\t\t\t\tif (!valueConfig) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// header validation, skip if isHeaderNameOptional\n\t\t\t\tif (rowIndex === 0) {\n\t\t\t\t\tif (config.isHeaderNameOptional && valueConfig.name === columnValue) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!config.isHeaderNameOptional) {\n\t\t\t\t\t\tif (valueConfig.name !== columnValue) {\n\t\t\t\t\t\t\tfile.inValidMessages.push(\n\t\t\t\t\t\t\t\t_isFunction(valueConfig.headerError)\n\t\t\t\t\t\t\t\t\t? valueConfig.headerError(columnValue)\n\t\t\t\t\t\t\t\t\t: 'Header name ' + columnValue + ' is not correct or missing'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (valueConfig.required && !columnValue.length) {\n\t\t\t\t\tfile.inValidMessages.push(\n\t\t\t\t\t\t_isFunction(valueConfig.requiredError)\n\t\t\t\t\t\t\t? valueConfig.requiredError(valueConfig.name, rowIndex + 1, columnIndex + 1)\n\t\t\t\t\t\t\t: String(valueConfig.name + ' is required in the ' + (rowIndex + 1) + ' row / ' + (columnIndex + 1) + ' column')\n\t\t\t\t\t);\n\t\t\t\t} else if (valueConfig.validate && !valueConfig.validate(columnValue)) {\n\t\t\t\t\tfile.inValidMessages.push(\n\t\t\t\t\t\t_isFunction(valueConfig.validateError)\n\t\t\t\t\t\t\t? valueConfig.validateError(valueConfig.name, rowIndex + 1, columnIndex + 1)\n\t\t\t\t\t\t\t: String(valueConfig.name + ' is not valid in the ' + (rowIndex + 1) + ' row / ' + (columnIndex + 1) + ' column')\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tif (valueConfig.optional) {\n\t\t\t\t\tcolumnData[valueConfig.inputName] = columnValue;\n\t\t\t\t}\n\n\t\t\t\tif (valueConfig.isArray) {\n\t\t\t\t\tcolumnData[valueConfig.inputName] = columnValue.split(',').map(function (value) {\n\t\t\t\t\t\treturn value.trim();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tcolumnData[valueConfig.inputName] = columnValue;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (Object.keys(columnData).length) {\n\t\t\t\tfile.data.push(columnData);\n\t\t\t}\n\t\t});\n\n\t\t_checkUniqueFields(file, config);\n\n\t\treturn file;\n\t}\n\n\t/**\n\t * @param {Object} file\n\t * @param {Object} config\n\t * @private\n\t */\n\tfunction _checkUniqueFields(file, config) {\n\t\tif (!file.data.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tconfig.headers\n\t\t\t.filter(function (header) {\n\t\t\t\treturn header.unique\n\t\t\t})\n\t\t\t.forEach(function (header) {\n\t\t\t\tif (!isValuesUnique(file.data, header.inputName)) {\n\t\t\t\t\tfile.inValidMessages.push(\n\t\t\t\t\t\t_isFunction(header.uniqueError)\n\t\t\t\t\t\t\t? header.uniqueError(header.name)\n\t\t\t\t\t\t\t: String(header.name + ' is not unique')\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t};\n\n\treturn CSVFileValidator;\n})));\n"],"mappings":"AAAC,WAAUA,MAAM,EAAEC,OAAO,EAAE;EAC3B,OAAOC,OAAO,KAAK,QAAQ,IAAI,OAAOC,MAAM,KAAK,WAAW,GACzDA,MAAM,CAACD,OAAO,GAAGD,OAAO,CAACG,OAAO,CAAC,WAAW,CAAC,EAAEA,OAAO,CAAC,eAAe,CAAC,EAAEA,OAAO,CAAC,mBAAmB,CAAC,EAAEA,OAAO,CAAC,wBAAwB,CAAC,CAAC,GACzI,OAAOC,MAAM,KAAK,UAAU,IAAIA,MAAM,CAACC,GAAG,GACzCD,MAAM,CAAC,CAAC,WAAW,EAAE,eAAe,EAAE,mBAAmB,EAAE,wBAAwB,CAAC,EAAEJ,OAAO,CAAC,GAC7FD,MAAM,CAACO,QAAQ,GAAGN,OAAO,CAACD,MAAM,CAACQ,IAAI,EAAER,MAAM,CAACS,OAAO,EAAET,MAAM,CAACU,WAAW,EAAEV,MAAM,CAACW,cAAc,CAAE;AACxG,CAAC,EAAC,IAAI,EAAG,UAAUH,IAAI,EAAEC,OAAO,EAAEC,WAAW,EAAEC,cAAc,EAAE;EAC9D,YAAY;;EAEZH,IAAI,GAAGA,IAAI,IAAIA,IAAI,CAACI,cAAc,CAAC,SAAS,CAAC,GAAGJ,IAAI,CAAC,SAAS,CAAC,GAAGA,IAAI;EACtEG,cAAc,GAAGA,cAAc,IAAIA,cAAc,CAACC,cAAc,CAAC,SAAS,CAAC,GAAGD,cAAc,CAAC,SAAS,CAAC,GAAGA,cAAc;EACxHF,OAAO,GAAGA,OAAO,IAAIA,OAAO,CAACG,cAAc,CAAC,SAAS,CAAC,GAAGH,OAAO,CAAC,SAAS,CAAC,GAAGA,OAAO;EACrFC,WAAW,GAAGA,WAAW,IAAIA,WAAW,CAACE,cAAc,CAAC,SAAS,CAAC,GAAGF,WAAW,CAAC,SAAS,CAAC,GAAGA,WAAW;;EAEzG;AACD;AACA;AACA;EACC,SAASG,gBAAgB,CAACC,OAAO,EAAEC,MAAM,EAAE;IAC1C,OAAO,IAAIC,OAAO,CAAC,UAAUC,OAAO,EAAEC,MAAM,EAAE;MAC7CV,IAAI,CAACW,KAAK,CAACL,OAAO,EAAE;QACnBM,cAAc,EAAE,IAAI;QACpBC,QAAQ,EAAE,kBAAUC,OAAO,EAAE;UAC5BL,OAAO,CAACM,2BAA2B,CAACD,OAAO,CAACE,IAAI,EAAET,MAAM,CAAC,CAAC;QAC3D,CAAC;QACDU,KAAK,EAAE,eAAUA,MAAK,EAAEC,IAAI,EAAE;UAC7BR,MAAM,CAAC;YAAEO,KAAK,EAAEA,MAAK;YAAEC,IAAI,EAAEA;UAAK,CAAC,CAAC;QACrC;MACD,CAAC,CAAC;IACH,CAAC,CAAC;EACH;;EAEA;AACD;AACA;AACA;AACA;EACC,SAASH,2BAA2B,CAACI,OAAO,EAAEZ,MAAM,EAAE;IACrD,IAAMW,IAAI,GAAG;MACZE,eAAe,EAAE,EAAE;MACnBJ,IAAI,EAAE;IACP,CAAC;IAEDG,OAAO,CAACE,OAAO,CAAC,UAAUC,GAAG,EAAEC,QAAQ,EAAE;MACxC,IAAMC,UAAU,GAAG,CAAC,CAAC;MACrB,IAAMC,OAAO,GAAG,EAAE;MAElB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGnB,MAAM,CAACkB,OAAO,CAACE,MAAM,EAAED,CAAC,EAAE,EAAE;QAC/C,IAAMV,IAAI,GAAGT,MAAM,CAACkB,OAAO,CAACC,CAAC,CAAC;QAE9B,IAAI,CAACV,IAAI,CAACY,QAAQ,EAAE;UACnBH,OAAO,CAACI,IAAI,CAACb,IAAI,CAAC;QACnB;MACD;MAEA,IAAIM,GAAG,CAACK,MAAM,GAAGF,OAAO,CAACE,MAAM,EAAE;QAChC;MACD;MAEAL,GAAG,CAACD,OAAO,CAAC,UAAUS,WAAW,EAAEC,WAAW,EAAE;QAC/C,IAAMC,WAAW,GAAGzB,MAAM,CAACkB,OAAO,CAACM,WAAW,CAAC;QAE/C,IAAI,CAACC,WAAW,EAAE;UACjB;QACD;;QAEA;QACA,IAAIT,QAAQ,KAAK,CAAC,EAAE;UACnB,IAAIhB,MAAM,CAAC0B,oBAAoB,IAAID,WAAW,CAACE,IAAI,KAAKJ,WAAW,EAAE;YACpE;UACD;UAEA,IAAI,CAACvB,MAAM,CAAC0B,oBAAoB,EAAE;YACjC,IAAID,WAAW,CAACE,IAAI,KAAKJ,WAAW,EAAE;cACrCZ,IAAI,CAACE,eAAe,CAACS,IAAI,CACxB3B,WAAW,CAAC8B,WAAW,CAACG,WAAW,CAAC,GACjCH,WAAW,CAACG,WAAW,CAACL,WAAW,CAAC,GACpC,cAAc,GAAGA,WAAW,GAAG,4BAA4B,CAC9D;YACF;YAEA;UACD;QACD;QAEA,IAAIE,WAAW,CAACI,QAAQ,IAAI,CAACN,WAAW,CAACH,MAAM,EAAE;UAChDT,IAAI,CAACE,eAAe,CAACS,IAAI,CACxB3B,WAAW,CAAC8B,WAAW,CAACK,aAAa,CAAC,GACnCL,WAAW,CAACK,aAAa,CAACL,WAAW,CAACE,IAAI,EAAEX,QAAQ,GAAG,CAAC,EAAEQ,WAAW,GAAG,CAAC,CAAC,GAC1EO,MAAM,CAACN,WAAW,CAACE,IAAI,GAAG,sBAAsB,IAAIX,QAAQ,GAAG,CAAC,CAAC,GAAG,SAAS,IAAIQ,WAAW,GAAG,CAAC,CAAC,GAAG,SAAS,CAAC,CACjH;QACF,CAAC,MAAM,IAAIC,WAAW,CAACO,QAAQ,IAAI,CAACP,WAAW,CAACO,QAAQ,CAACT,WAAW,CAAC,EAAE;UACtEZ,IAAI,CAACE,eAAe,CAACS,IAAI,CACxB3B,WAAW,CAAC8B,WAAW,CAACQ,aAAa,CAAC,GACnCR,WAAW,CAACQ,aAAa,CAACR,WAAW,CAACE,IAAI,EAAEX,QAAQ,GAAG,CAAC,EAAEQ,WAAW,GAAG,CAAC,CAAC,GAC1EO,MAAM,CAACN,WAAW,CAACE,IAAI,GAAG,uBAAuB,IAAIX,QAAQ,GAAG,CAAC,CAAC,GAAG,SAAS,IAAIQ,WAAW,GAAG,CAAC,CAAC,GAAG,SAAS,CAAC,CAClH;QACF;QAEA,IAAIC,WAAW,CAACJ,QAAQ,EAAE;UACzBJ,UAAU,CAACQ,WAAW,CAACS,SAAS,CAAC,GAAGX,WAAW;QAChD;QAEA,IAAIE,WAAW,CAACU,OAAO,EAAE;UACxBlB,UAAU,CAACQ,WAAW,CAACS,SAAS,CAAC,GAAGX,WAAW,CAACa,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAAC,UAAUC,KAAK,EAAE;YAC/E,OAAOA,KAAK,CAACC,IAAI,EAAE;UACpB,CAAC,CAAC;QACH,CAAC,MAAM;UACNtB,UAAU,CAACQ,WAAW,CAACS,SAAS,CAAC,GAAGX,WAAW;QAChD;MACD,CAAC,CAAC;MAEF,IAAIiB,MAAM,CAACC,IAAI,CAACxB,UAAU,CAAC,CAACG,MAAM,EAAE;QACnCT,IAAI,CAACF,IAAI,CAACa,IAAI,CAACL,UAAU,CAAC;MAC3B;IACD,CAAC,CAAC;IAEFyB,kBAAkB,CAAC/B,IAAI,EAAEX,MAAM,CAAC;IAEhC,OAAOW,IAAI;EACZ;;EAEA;AACD;AACA;AACA;AACA;EACC,SAAS+B,kBAAkB,CAAC/B,IAAI,EAAEX,MAAM,EAAE;IACzC,IAAI,CAACW,IAAI,CAACF,IAAI,CAACW,MAAM,EAAE;MACtB;IACD;IAEApB,MAAM,CAACkB,OAAO,CACZyB,MAAM,CAAC,UAAUC,MAAM,EAAE;MACzB,OAAOA,MAAM,CAACC,MAAM;IACrB,CAAC,CAAC,CACD/B,OAAO,CAAC,UAAU8B,MAAM,EAAE;MAC1B,IAAI,CAAChD,cAAc,CAACe,IAAI,CAACF,IAAI,EAAEmC,MAAM,CAACV,SAAS,CAAC,EAAE;QACjDvB,IAAI,CAACE,eAAe,CAACS,IAAI,CACxB3B,WAAW,CAACiD,MAAM,CAACE,WAAW,CAAC,GAC5BF,MAAM,CAACE,WAAW,CAACF,MAAM,CAACjB,IAAI,CAAC,GAC/BI,MAAM,CAACa,MAAM,CAACjB,IAAI,GAAG,gBAAgB,CAAC,CACzC;MACF;IACD,CAAC,CAAC;EACJ;EAAC;EAED,OAAO7B,gBAAgB;AACxB,CAAC,CAAE"},"metadata":{},"sourceType":"script","externalDependencies":[]}